import{c as A,g as ge,r as i,o as be,w as fe,b as a,e as s,v as h,j as Q,k as W,F as C,f as N,U as _e,l as D,t as r,h as ke,s as F,I,L as X,m as Ce,i as n,n as E,N as Ne,S as we}from"./vendor.Bh3_gxHF.js";import{u as Ae}from"./documents.CHcazOjv.js";import{_ as De,a as Ee,h as qe}from"./index.Cv61STol.js";const Se={class:"document-edit-container"},xe={class:"notifications-container"},Fe={class:"notification-message"},Ie=["onClick"],Me={class:"page-header"},Pe={class:"header-top"},Te={class:"page-title"},Le={class:"breadcrumb"},$e={class:"breadcrumb-current"},Be={class:"content-layout"},Ue={class:"main-content"},Ve={class:"upload-container"},je={class:"files-section"},Re={key:0,class:"uploaded-files"},He={class:"file-info"},Oe={key:0,class:"file-icon",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},Je=["src","alt"],Ge={class:"file-details"},ze={class:"file-name"},Ze={class:"file-type"},Qe=["onClick"],We={key:1,class:"no-files"},Xe={key:0,class:"file-summary-section"},Ye={class:"section-title"},Ke={class:"edit-section"},et={class:"section-header"},tt={class:"section-title"},st={class:"section-description"},ot={class:"form-list"},lt=["for"],at={key:0,class:"required"},nt=["id","onUpdate:modelValue","placeholder"],rt=["id","onUpdate:modelValue"],it={value:"",disabled:"",selected:""},dt=["value"],ut={key:2,class:"input-wrapper"},ct=["id","onUpdate:modelValue","type","placeholder"],pt={key:3,class:"error-message"},mt={class:"sidebar"},vt={class:"agents-section"},yt={key:0,class:"agents-list"},ht={class:"agent-info"},gt=["src","alt"],bt={class:"agent-details"},ft={class:"agent-name"},_t={class:"agent-email"},kt=["onClick"],Ct={class:"modal-container"},Nt={class:"modal-header"},wt={class:"modal-container"},At={class:"modal-header"},Dt={class:"modal-body"},Et={class:"search-box"},qt={class:"agent-list"},St=["onClick"],xt=["src","alt"],Ft={class:"agent-details"},It={class:"agent-name"},Mt={class:"agent-experience"},Pt={class:"modal-footer"},Tt={__name:"AdminDocumentEdit",setup(Lt){const q=ge(),Y=Ce(),M=Ae(),K=Ee(),ee=qe(),U=A(()=>q.params.id),p=i(null),m=A(()=>q.name==="AdminDocumentCreate"),l=i({id:null,type:"buyer-rep",title:"",clientId:null,description:"",associatedAgents:[],files:[],buyerName:"",buyerEmail:"",phoneNumber:"",propertyType:"",budgetRange:"",additionalNotes:"",sellerName:"",sellerEmail:"",propertyAddress:"",listingPrice:"",bedrooms:"",bathrooms:"",squareFootage:"",propertyDescription:""}),P=i({}),g=i(!1),b=i(!1),v=i({}),te=i(!1),S=i([]),T=i(!1),L=i(""),f=i([]),$=i(!0),V=i(!1),j=i(null),c=i([]),_=i([]),w=A(()=>[...c.value,..._.value]),R=A(()=>{const e=[{name:"title",label:"Document Title",type:"text",placeholder:"Enter document title",required:!0},{name:"type",label:"Document Type",type:"select",options:["buyer-rep","seller-rep","mls"],required:!0},{name:"description",label:"Description",type:"textarea",placeholder:"Add a description of this document",required:!1}],t={"buyer-rep":[{name:"buyerName",label:"Buyer Name",type:"text",placeholder:"Enter buyer's full name",required:!0},{name:"buyerEmail",label:"Buyer Email",type:"email",placeholder:"Enter buyer's email address",required:!0},{name:"phoneNumber",label:"Phone Number",type:"tel",placeholder:"Enter buyer's phone number",required:!0},{name:"propertyType",label:"Property Type",type:"select",options:["Single Family Home","Condo","Townhouse","Multi-Family","Land","Commercial"],required:!0},{name:"budgetRange",label:"Budget Range",type:"text",placeholder:"e.g. $200,000-$300,000",required:!0},{name:"additionalNotes",label:"Additional Notes",type:"textarea",placeholder:"Any additional information about the buyer or their requirements",required:!1}],"seller-rep":[{name:"sellerName",label:"Seller Name",type:"text",placeholder:"Enter seller's full name",required:!0},{name:"sellerEmail",label:"Seller Email",type:"email",placeholder:"Enter seller's email address",required:!0},{name:"phoneNumber",label:"Phone Number",type:"tel",placeholder:"Enter seller's phone number",required:!0},{name:"propertyType",label:"Property Type",type:"select",options:["Single Family Home","Condo","Townhouse","Multi-Family","Land","Commercial"],required:!0},{name:"propertyAddress",label:"Property Address",type:"text",placeholder:"Enter the property address",required:!0},{name:"listingPrice",label:"Listing Price",type:"text",placeholder:"e.g. $500,000",required:!0},{name:"additionalNotes",label:"Additional Notes",type:"textarea",placeholder:"Any additional information about the seller or property",required:!1}],mls:[{name:"propertyAddress",label:"Property Address",type:"text",placeholder:"Enter the property address",required:!0},{name:"listingPrice",label:"Listing Price",type:"text",placeholder:"e.g. $500,000",required:!0},{name:"bedrooms",label:"Bedrooms",type:"text",placeholder:"Number of bedrooms",required:!0},{name:"bathrooms",label:"Bathrooms",type:"text",placeholder:"Number of bathrooms",required:!0},{name:"squareFootage",label:"Square Footage",type:"text",placeholder:"e.g. 2,500",required:!0},{name:"propertyDescription",label:"Property Description",type:"textarea",placeholder:"Detailed description of the property",required:!0}]};return[...e,...t[l.value.type]||[]]}),se=A(()=>{const e=L.value.toLowerCase();return K.agents.filter(t=>t.name.toLowerCase().includes(e)||t.email&&t.email.toLowerCase().includes(e))}),oe=()=>{if(!p.value)return"";const e=ee.getClientById(p.value);return e?e.name:"Unknown Client"};be(async()=>{if(q.query.clientId&&(p.value=parseInt(q.query.clientId),l.value.clientId=p.value),!m.value&&U.value)try{$.value=!0;const e=await M.fetchDocument(U.value);e?(p.value=e.clientId,l.value={id:e.id,type:e.type||"buyer-rep",title:e.name||"",clientId:e.clientId,description:e.description||"",associatedAgents:e.agents||[],buyerName:e.buyerName||"",buyerEmail:e.buyerEmail||"",sellerName:e.sellerName||"",sellerEmail:e.sellerEmail||"",phoneNumber:e.phoneNumber||"",propertyType:e.propertyType||"",propertyAddress:e.propertyAddress||"",listingPrice:e.listingPrice||"",budgetRange:e.budgetRange||"",bedrooms:e.bedrooms||"",bathrooms:e.bathrooms||"",squareFootage:e.squareFootage||"",propertyDescription:e.propertyDescription||"",additionalNotes:e.additionalNotes||""},e.files&&e.files.length>0&&(c.value=[...e.files]),P.value=JSON.parse(JSON.stringify(l.value))):u("Document not found","error")}catch(e){console.error("Error loading document:",e),u(`Failed to load document: ${e.message||"Unknown error"}`,"error")}finally{$.value=!1}else $.value=!1}),fe(()=>l.value.type,()=>{ve()});const u=(e,t="info")=>{const k=Date.now();S.value.push({id:k,message:e,type:t}),setTimeout(()=>{H(k)},5e3)},H=e=>{S.value=S.value.filter(t=>t.id!==e)},le=()=>{j.value.click()},ae=e=>{const t=e.target.files;t.length>0&&Array.from(t).forEach(O),e.target.value=null},ne=e=>{const t=e.dataTransfer.files;t.length>0&&Array.from(t).forEach(O)},O=async e=>{try{const t={name:e.name,type:e.type,size:e.size,content:null,preview:null};J(e.type)&&(t.preview=URL.createObjectURL(e)),_.value.push(t),y(),u(`File "${e.name}" added successfully`,"success")}catch(t){u(`Error reading file ${e.name}: ${t.message}`,"error")}},re=e=>{let t="";e<c.value.length?(t=c.value[e].name,c.value.splice(e,1)):(t=_.value[e-c.value.length].name,_.value.splice(e-c.value.length,1)),y(),u(`File "${t}" removed`,"success")},ie=e=>e.includes("pdf")||e.includes("doc")||e.includes("xls")||e.includes("ppt"),J=e=>e.includes("image/"),de=()=>{f.value=[...l.value.associatedAgents],T.value=!0},B=e=>{e&&(l.value.associatedAgents=[...f.value],y()),T.value=!1},ue=e=>f.value.some(t=>t.id===e.id),ce=e=>{const t=f.value.findIndex(k=>k.id===e.id);t===-1?f.value.push(e):f.value.splice(t,1)},pe=e=>{l.value.associatedAgents=l.value.associatedAgents.filter(t=>t.id!==e),y()},me=()=>{const e={};return te.value=!0,R.value.forEach(t=>{t.required&&!l.value[t.name]&&(e[t.name]=`${t.label} is required`)}),v.value=e,Object.keys(e).length===0},ve=()=>{v.value={}},y=()=>{var e;if(m.value){g.value=!0;return}if(JSON.stringify(l.value)!==JSON.stringify(P.value)){g.value=!0;return}if(c.value.length!==((e=P.value.files)==null?void 0:e.length)||_.value.length>0){g.value=!0;return}g.value=!1},G=()=>{g.value?b.value=!0:x()},x=()=>{Y.push({path:`/clients/${p.value}`,query:{tab:"documents"}})},ye=()=>{b.value=!1,x()},he=async()=>{if(!me()){u("Please fill in all required fields","error");return}g.value?z():x()},z=async()=>{try{u("Saving document...","info"),b.value=!1,V.value=!0;const e={id:l.value.id,name:l.value.title,type:l.value.type,description:l.value.description,agents:l.value.associatedAgents,files:[...c.value,..._.value],clientId:l.value.clientId,createdAt:new Date().toISOString().split("T")[0]};if(l.value.type==="buyer-rep"?(e.buyerName=l.value.buyerName,e.buyerEmail=l.value.buyerEmail,e.phoneNumber=l.value.phoneNumber,e.propertyType=l.value.propertyType,e.budgetRange=l.value.budgetRange,e.additionalNotes=l.value.additionalNotes):l.value.type==="seller-rep"?(e.sellerName=l.value.sellerName,e.sellerEmail=l.value.sellerEmail,e.phoneNumber=l.value.phoneNumber,e.propertyType=l.value.propertyType,e.propertyAddress=l.value.propertyAddress,e.listingPrice=l.value.listingPrice,e.additionalNotes=l.value.additionalNotes):l.value.type==="mls"&&(e.propertyAddress=l.value.propertyAddress,e.listingPrice=l.value.listingPrice,e.bedrooms=l.value.bedrooms,e.bathrooms=l.value.bathrooms,e.squareFootage=l.value.squareFootage,e.propertyDescription=l.value.propertyDescription),m.value){const t=await M.addDocument(e);console.log("Created document with ID:",t),u("Document created successfully","success")}else await M.updateDocument(l.value.id,e),u("Document updated successfully","success");setTimeout(()=>{x()},1500)}catch(e){console.error("Error saving document:",e),u(`Error saving document: ${e.message||"Unknown error"}`,"error")}finally{V.value=!1}};return(e,t)=>{var Z;const k=ke("router-link");return n(),a("div",Se,[s("div",xe,[Q(_e,{name:"notification"},{default:W(()=>[(n(!0),a(C,null,N(S.value,o=>(n(),a("div",{key:o.id,class:E(["notification",o.type])},[s("span",Fe,r(o.message),1),s("button",{class:"notification-close",onClick:d=>H(o.id)},"×",8,Ie)],2))),128))]),_:1})]),s("div",Me,[s("div",Pe,[s("button",{class:"back-button",onClick:G},t[7]||(t[7]=[s("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},[s("path",{d:"M15.8337 10H4.16699M4.16699 10L10.0003 15.8333M4.16699 10L10.0003 4.16667",stroke:"currentColor","stroke-width":"1.67","stroke-linecap":"round","stroke-linejoin":"round"})],-1),D(" Back ")])),s("h1",Te,"Admin - "+r(m.value?"Create":"Edit")+" document for "+r(oe()),1)]),s("div",Le,[Q(k,{to:`/clients/${p.value}`,class:"breadcrumb-link"},{default:W(()=>t[8]||(t[8]=[D("Client Profile")])),_:1},8,["to"]),t[9]||(t[9]=s("span",{class:"breadcrumb-separator"},"/",-1)),s("span",$e,r(m.value?"New Document":"Edit Document"),1)])]),s("div",Be,[s("div",Ue,[s("div",Ve,[s("div",{class:"upload-area",onDrop:F(ne,["prevent"]),onDragover:t[0]||(t[0]=F(()=>{},["prevent"]))},[t[11]||(t[11]=s("div",{class:"upload-icon"},[s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[s("path",{d:"M12 12V19M12 12L15 15M12 12L9 15M20 16.7428C21.2215 15.734 22 14.2079 22 12.5C22 9.46243 19.5376 7 16.5 7C16.2815 7 16.0771 7.01349 15.8767 7.03857C14.9827 4.67583 12.6997 3 10 3C6.13401 3 3 6.13401 3 10C3 12.2501 4.07741 14.2509 5.75 15.4805",stroke:"#6B7280","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),s("div",{class:"upload-text"},[t[10]||(t[10]=D(" Upload document by Dragging & dropping files or ")),s("button",{onClick:le,class:"browse-link"},"Browse")]),t[12]||(t[12]=s("div",{class:"upload-formats"}," Supported formats: PDF, DOC, XLS, PPT, JPG, PNG, GIF ",-1)),s("input",{type:"file",ref_key:"fileInput",ref:j,onChange:ae,multiple:"",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif",class:"hidden"},null,544)],32),s("div",je,[t[15]||(t[15]=s("h3",{class:"section-title"},"Attached Files",-1)),w.value.length>0?(n(),a("div",Re,[(n(!0),a(C,null,N(w.value,(o,d)=>(n(),a("div",{key:d,class:"file-item"},[s("div",He,[ie(o.type)?(n(),a("svg",Oe,t[13]||(t[13]=[s("path",{d:"M7.5 9.16667H12.5M7.5 12.5H10.8333M6.66667 2.5H13.3333L17.5 6.66667V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V4.16667C2.5 3.72464 2.67559 3.30072 2.98816 2.98816C3.30072 2.67559 3.72464 2.5 4.16667 2.5H6.66667ZM13.3333 2.5V6.66667H17.5L13.3333 2.5Z",stroke:"#6B7280","stroke-width":"1.67","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):J(o.type)?(n(),a("img",{key:1,src:o.preview,class:"file-preview",alt:o.name},null,8,Je)):h("",!0),s("div",Ge,[s("span",ze,r(o.name),1),s("span",Ze,r(o.type),1)])]),s("button",{onClick:$t=>re(d),class:"file-remove"},t[14]||(t[14]=[s("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},[s("path",{d:"M13.3333 5L6.66667 11.6667M6.66667 5L13.3333 11.6667",stroke:"#EF4444","stroke-width":"1.67","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,Qe)]))),128))])):(n(),a("div",We," No files attached yet "))]),w.value.length>0?(n(),a("div",Xe,[s("h3",Ye,r(w.value.length)+" "+r(w.value.length===1?"file":"files")+" attached",1)])):h("",!0)]),s("div",Ke,[s("div",et,[s("h2",tt,r(m.value?"Create":"Edit")+" document",1),s("p",st,r(m.value?"Create a new document for this client":"Edit document details and attached files"),1)]),s("div",ot,[(n(!0),a(C,null,N(R.value,o=>(n(),a("div",{key:o.name,class:"form-group"},[s("label",{for:o.name,class:"form-label"},[D(r(o.label)+" ",1),o.required?(n(),a("span",at,"*")):h("",!0)],8,lt),o.type==="textarea"?I((n(),a("textarea",{key:0,id:o.name,"onUpdate:modelValue":d=>l.value[o.name]=d,placeholder:o.placeholder,class:E(["form-control",{error:v.value[o.name]}]),rows:"4",onInput:y},null,42,nt)),[[X,l.value[o.name]]]):o.type==="select"?I((n(),a("select",{key:1,id:o.name,"onUpdate:modelValue":d=>l.value[o.name]=d,class:E(["form-control",{error:v.value[o.name]}]),onChange:y},[s("option",it,"Select "+r(o.label.toLowerCase()),1),(n(!0),a(C,null,N(o.options,d=>(n(),a("option",{key:d,value:d},r(d),9,dt))),128))],42,rt)),[[Ne,l.value[o.name]]]):(n(),a("div",ut,[I(s("input",{id:o.name,"onUpdate:modelValue":d=>l.value[o.name]=d,type:o.type,placeholder:o.placeholder,class:E(["form-control",{error:v.value[o.name]}]),onInput:y},null,42,ct),[[we,l.value[o.name]]])])),v.value[o.name]?(n(),a("span",pt,r(v.value[o.name]),1)):h("",!0)]))),128))])])]),s("div",mt,[s("div",vt,[t[18]||(t[18]=s("h3",{class:"agents-title"},"Associated agents",-1)),(Z=l.value.associatedAgents)!=null&&Z.length?(n(),a("div",yt,[(n(!0),a(C,null,N(l.value.associatedAgents,o=>(n(),a("div",{key:o.id,class:"agent-card"},[s("div",ht,[s("img",{src:o.avatar,alt:o.name,class:"agent-avatar"},null,8,gt),s("div",bt,[s("span",ft,r(o.name),1),s("span",_t,r(o.email),1)])]),s("button",{onClick:d=>pe(o.id),class:"remove-agent"},t[16]||(t[16]=[s("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},[s("path",{d:"M13.3333 5L6.66667 11.6667M6.66667 5L13.3333 11.6667",stroke:"#EF4444","stroke-width":"1.67","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,kt)]))),128))])):h("",!0),s("button",{class:"add-agent-button",onClick:de},t[17]||(t[17]=[s("span",{class:"plus-icon"},"+",-1),D(" Add agent ")]))])])]),s("div",{class:"page-footer"},[s("button",{class:"btn-secondary",onClick:G},"Cancel"),s("button",{class:"btn-primary",onClick:he},"Save Document")]),b.value?(n(),a("div",{key:0,class:"modal-overlay",onClick:t[2]||(t[2]=F(o=>b.value=!1,["self"]))},[s("div",Ct,[s("div",Nt,[t[19]||(t[19]=s("h3",null,"Unsaved Changes",-1)),s("button",{onClick:t[1]||(t[1]=o=>b.value=!1),class:"modal-close"},"×")]),t[20]||(t[20]=s("div",{class:"modal-body"},[s("p",null,"You have unsaved changes. What would you like to do?")],-1)),s("div",{class:"modal-footer"},[s("button",{class:"btn-secondary",onClick:ye},"Discard Changes"),s("button",{class:"btn-primary",onClick:z},"Save Changes")])])])):h("",!0),T.value?(n(),a("div",{key:1,class:"modal-overlay",onClick:t[6]||(t[6]=F(o=>B(!1),["self"]))},[s("div",wt,[s("div",At,[t[21]||(t[21]=s("h3",null,"Select Agents",-1)),s("button",{onClick:t[3]||(t[3]=o=>B(!1)),class:"modal-close"},"×")]),s("div",Dt,[s("div",Et,[I(s("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=o=>L.value=o),placeholder:"Search agents by name or email",class:"form-control"},null,512),[[X,L.value]])]),s("div",qt,[(n(!0),a(C,null,N(se.value,o=>(n(),a("div",{key:o.id,class:E(["agent-item",{selected:ue(o)}]),onClick:d=>ce(o)},[s("img",{src:o.avatar,alt:o.name,class:"agent-avatar"},null,8,xt),s("div",Ft,[s("span",It,r(o.name),1),s("span",Mt,r(o.experience),1)])],10,St))),128))])]),s("div",Pt,[s("button",{class:"btn-primary",onClick:t[5]||(t[5]=o=>B(!0))},"Done")])])])):h("",!0)])}}},jt=De(Tt,[["__scopeId","data-v-ce583be9"]]);export{jt as default};
