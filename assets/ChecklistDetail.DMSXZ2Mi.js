import{r as _,c as g,o as j,g as T,b as a,v as i,e as t,j as L,t as l,u as A,l as f,n as x,A as z,s as J,F as H,f as $,m as U,i as n}from"./vendor.Bh3_gxHF.js";import{C as Y}from"./ConfirmationModal.CCQCvGTg.js";import{u as q}from"./marketingStore.D46PyJfU.js";import{_ as G,b as K}from"./index.Cv61STol.js";const Q={class:"checklist-detail"},W={key:0,class:"admin-view-banner"},X={class:"debug-info",style:{background:"#f0f0f0",padding:"10px","margin-bottom":"10px","font-family":"monospace"}},Z={class:"header"},ee={key:0,class:"actions"},te={key:1,class:"content"},se={class:"checklist-header"},oe={class:"meta"},le={class:"date"},ae={key:0,class:"status-badge overdue"},ne={key:1,class:"creator-badge"},re={class:"creator-name"},ie={key:0,class:"progress-section"},ce={class:"progress-info"},ue={class:"progress-text"},de={class:"progress-bar"},ve={key:0,class:"due-date"},me={key:0,class:"overdue-text"},he={key:1,class:"converted-plan-info"},ke={class:"plan-badge"},pe={class:"items-section"},ge={class:"items-list"},fe={class:"item-content"},Ce=["checked","onChange","disabled"],we={class:"item-text"},ye={key:2,class:"not-found"},_e={__name:"ChecklistDetail",setup(xe){const u=U(),C=T(),d=q(),w=K(),e=_(null),h=_(!1),v=_({title:"",message:"",type:"",confirmText:""}),m=g(()=>w.currentRole==="admin"),y=g(()=>!e.value||!e.value.creator?!1:e.value.creator.name===w.getCurrentUser().name),b=g(()=>y.value||m.value),k=g(()=>{var o;return y.value&&!((o=e.value)!=null&&o.completed)});j(async()=>{console.log("Component mounted, loading checklist..."),await P()});const P=async()=>{try{await d.checklists.fetchChecklists(),console.log("All checklists:",d.checklists.marketingChecklists),console.log("Current route ID:",C.params.id);const o=d.checklists.marketingChecklists.find(s=>String(s.id)===String(C.params.id));console.log("Found checklist:",o),o?(e.value=o,console.log("Checklist loaded successfully")):(console.warn("Checklist not found"),e.value=null)}catch(o){console.error("Error loading checklist:",o),e.value=null}},D=o=>new Date(o).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}),M=o=>o.dueDate?new Date(o.dueDate)<new Date:!1,B=o=>{if(!o.dueDate)return 0;const s=new Date-new Date(o.dueDate);return Math.floor(s/(1e3*60*60*24))},F=async o=>{if(!e.value||e.value.completed||!k.value)return;e.value.items[o].completed=!e.value.items[o].completed;const s=e.value.items.filter(c=>c.completed).length;e.value.progress=Math.round(s/e.value.items.length*100);const r=e.value.status==="completed";e.value.progress===100?(e.value.status="completed",!r&&e.value.convertedFromPlan&&await S("Completed")):(e.value.status="draft",r&&e.value.convertedFromPlan&&await S("Active")),await O()},S=async o=>{if(e.value.convertedFromPlan)try{const s=e.value.convertedFromPlan.id,r=d.plans.marketingPlans,c=r.findIndex(p=>String(p.index)===String(s));c!==-1?(r[c].status=o,localStorage.setItem("marketingPlans",JSON.stringify(r)),console.log(`Original marketing plan status updated to ${o}`)):console.warn("Original marketing plan not found")}catch(s){console.error("Error updating original plan status:",s)}},I=()=>{h.value=!0,v.value={title:"Leave Checklist",message:"Do you want to return to the checklist list?",type:"default",confirmText:"Leave",onConfirm:()=>{m.value?u.push("/marketing-tools/admin-checklists"):u.push("/marketing-tools/checklist")}}},E=()=>{u.push(`/marketing-tools/checklist/${e.value.id}/edit`)},N=()=>{h.value=!0,v.value={title:"Delete Checklist",message:"Are you sure you want to delete this checklist? This action cannot be undone.",type:"danger",confirmText:"Delete",onConfirm:()=>{try{const s=d.checklists.marketingChecklists.filter(r=>r.id!==e.value.id);localStorage.setItem("marketingChecklists",JSON.stringify(s)),u.push("/marketing-tools/checklist")}catch(o){console.error("Error deleting checklist:",o)}}}},O=async()=>{if(e.value)try{const o=d.checklists.marketingChecklists,s=o.findIndex(r=>r.id===e.value.id);s!==-1&&(o[s]={...e.value,lastModified:new Date().toISOString()},localStorage.setItem("marketingChecklists",JSON.stringify(o)),console.log("Checklist saved successfully"))}catch(o){console.error("Error saving checklist:",o)}},R=async()=>{try{const o=JSON.parse(localStorage.getItem("checklists")||"[]"),s=o.findIndex(r=>r.id===e.value.id);s!==-1&&(o[s]=e.value,localStorage.setItem("checklists",JSON.stringify(o)),h.value=!1,u.push("/RCR/marketing-tools/checklist"))}catch(o){console.error("Error saving checklist:",o)}},V=()=>{e.value&&e.value.convertedFromPlan&&u.push(`/marketing-tools/plan/${e.value.convertedFromPlan.id}`)};return(o,s)=>{var r;return n(),a("div",Q,[m.value&&!y.value?(n(),a("div",W,s[1]||(s[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",class:"admin-icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1),t("div",{class:"admin-view-message"},[t("strong",null,"Admin View Mode"),t("span",null,"You are viewing this checklist as an administrator. Changes are disabled.")],-1)]))):i("",!0),t("div",X,[t("p",null,"Route ID: "+l(A(C).params.id),1),t("p",null,"Checklist loaded: "+l(e.value!==null),1),t("p",null,"Checklist ID: "+l((r=e.value)==null?void 0:r.id),1),t("p",null,"User Role: "+l(A(w).currentRole),1),t("p",null,"Can Edit: "+l(b.value),1),t("p",null,"Can Modify Items: "+l(k.value),1)]),t("div",Z,[t("button",{class:"back-btn",onClick:I},[s[2]||(s[2]=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",class:"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)),f(" "+l(m.value?"Back to Checklist Overview":"Back to Checklists"),1)]),e.value&&b.value?(n(),a("div",ee,[!e.value.completed&&!m.value?(n(),a("button",{key:0,class:"edit-btn",onClick:E},s[3]||(s[3]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",class:"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),f(" Edit ")]))):i("",!0),m.value?i("",!0):(n(),a("button",{key:1,class:"delete-btn",onClick:N},s[4]||(s[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",class:"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),f(" Delete ")])))])):i("",!0)]),e.value?(n(),a("div",te,[t("div",se,[t("h1",null,l(e.value.title),1),t("div",oe,[t("span",le,"Created: "+l(D(e.value.creationDate)),1),t("span",{class:x(["status-badge",e.value.status])},l(e.value.status),3),M(e.value)?(n(),a("span",ae," Overdue ")):i("",!0),e.value.creator?(n(),a("div",ne,[s[5]||(s[5]=t("span",{class:"creator-label"},"Created by:",-1)),t("span",re,l(e.value.creator.name),1),t("span",{class:x(["creator-role",e.value.creator.role])},l(e.value.creator.role),3)])):i("",!0)])]),e.value.completed?i("",!0):(n(),a("div",ie,[t("div",ce,[t("span",ue,l(e.value.progress)+"% Complete",1),t("div",de,[t("div",{class:"progress-fill",style:z({width:e.value.progress+"%"})},null,4)])]),e.value.dueDate?(n(),a("div",ve,[f(" Due: "+l(D(e.value.dueDate))+" ",1),M(e.value)?(n(),a("span",me," ("+l(B(e.value))+" days overdue) ",1)):i("",!0)])):i("",!0)])),e.value.convertedFromPlan?(n(),a("div",he,[t("div",ke,[s[6]||(s[6]=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",class:"plan-icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})],-1)),s[7]||(s[7]=t("span",null,"Converted from Marketing Plan:",-1)),t("a",{onClick:J(V,["prevent"]),class:"plan-link"},l(e.value.convertedFromPlan.title),1)])])):i("",!0),t("div",pe,[s[8]||(s[8]=t("h2",null,"Checklist Items",-1)),t("div",ge,[(n(!0),a(H,null,$(e.value.items,(c,p)=>(n(),a("div",{key:p,class:x(["checklist-item",{completed:c.completed}])},[t("div",fe,[t("input",{type:"checkbox",checked:c.completed,onChange:be=>F(p),disabled:e.value.completed||!k.value},null,40,Ce),t("span",we,l(c.text),1)])],2))),128))])])])):(n(),a("div",ye,[s[9]||(s[9]=t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",class:"not-found-icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M12 12h.01M12 21a9 9 0 110-18 9 9 0 010 18z"})],-1)),s[10]||(s[10]=t("h2",null,"Checklist Not Found",-1)),s[11]||(s[11]=t("p",null,"The checklist you're looking for doesn't exist or has been deleted.",-1)),t("button",{class:"back-btn",onClick:I},"Return to Checklists")])),k.value?(n(),a("button",{key:3,onClick:O,class:"btn-save"},"Save Changes")):i("",!0),L(Y,{modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=c=>h.value=c),title:v.value.title,message:v.value.message,type:v.value.type,"confirm-text":v.value.confirmText,onConfirm:R},null,8,["modelValue","title","message","type","confirm-text"])])}}},Oe=G(_e,[["__scopeId","data-v-717d6b20"]]);export{Oe as default};
