import{g as _e,r as u,c as f,o as ke,m as Ae,b as l,e as s,v as b,j as X,k as Y,F as C,f as N,U as Ce,l as F,t as c,h as Ne,s as M,I as T,L as K,i as n,n as q,N as we,S as Se}from"./vendor.Bh3_gxHF.js";import{u as xe}from"./documents.CHcazOjv.js";import{_ as De,b as V}from"./index.Cv61STol.js";const Fe={class:"document-edit-container"},qe={class:"notifications-container"},Ee={class:"notification-message"},Pe=["onClick"],Me={class:"page-header"},Te={class:"header-top"},Le={class:"page-title"},Re={class:"breadcrumb"},Ie={class:"content-layout"},$e={class:"main-content"},je={class:"upload-container"},Be={class:"files-section"},Oe={key:0,class:"uploaded-files"},Je={class:"file-info"},Ve={key:0,class:"file-icon",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},Ue=["src","alt"],He={class:"file-details"},Ge={class:"file-name"},Ze={class:"file-type"},ze=["onClick"],Qe={key:1,class:"no-files"},We={key:0,class:"file-summary-section"},Xe={class:"section-title"},Ye={class:"edit-section"},Ke={class:"form-list"},et=["for"],tt={key:0,class:"required"},st=["id","onUpdate:modelValue","placeholder"],at=["id","onUpdate:modelValue"],ot={value:"",disabled:"",selected:""},lt=["value"],nt={key:2,class:"input-wrapper"},rt=["id","onUpdate:modelValue","type","placeholder"],it={key:3,class:"error-message"},dt={class:"sidebar"},ut={class:"agents-section"},ct={key:0,class:"agents-list"},pt={class:"agent-info"},mt=["src","alt"],vt={class:"agent-details"},yt={class:"agent-name"},gt={class:"agent-email"},ht=["onClick"],ft={class:"modal-container"},bt={class:"modal-header"},_t={class:"modal-container"},kt={class:"modal-header"},At={class:"modal-body"},Ct={class:"search-box"},Nt={class:"agent-list"},wt=["onClick"],St=["src","alt"],xt={class:"agent-details"},Dt={class:"agent-name"},Ft={class:"agent-experience"},qt={class:"modal-footer"},Et={__name:"DocumentEdit",setup(Pt){const L=_e(),v=Ae(),R=xe(),y=L.params.id,_=u(!1),U=u(null),w=u([]),g=u([]),S=u(!1),k=f(()=>[...g.value,...w.value]),o=u({id:y||"",type:L.query.type||"buyer-rep",title:"",description:"",associatedAgents:[],files:[],buyerName:"",buyerEmail:"",phoneNumber:"",propertyType:"",budgetRange:"",additionalNotes:"",sellerName:"",sellerEmail:"",propertyAddress:"",listingPrice:"",squareFootage:"",bedrooms:"",bathrooms:"",propertyDescription:""}),x=u(null),D=u("buyer-rep"),I=u(!1),$=u(""),m=u([]),ee=u([{id:1,name:"John Doe",email:"john@example.com",avatar:"/avatars/john.jpg",experience:"5 years"},{id:2,name:"Jane Smith",email:"jane@example.com",avatar:"/avatars/jane.jpg",experience:"8 years"},{id:3,name:"Mike Johnson",email:"mike@example.com",avatar:"/avatars/mike.jpg",experience:"3 years"}]),te=f(()=>{const e=$.value.toLowerCase();return ee.value.filter(t=>t.name.toLowerCase().includes(e)||t.email.toLowerCase().includes(e))}),h=()=>{var e;if(x.value){if(JSON.stringify(o.value)!==JSON.stringify(x.value)){S.value=!0;return}if(k.value.length!==((e=x.value.files)==null?void 0:e.length)){S.value=!0;return}S.value=!1}},se=()=>{m.value=o.value.associatedAgents?JSON.parse(JSON.stringify(o.value.associatedAgents)):[],I.value=!0},j=(e=!1)=>{if(e){o.value.associatedAgents||(o.value.associatedAgents=[]);const t=o.value.associatedAgents.map(d=>d.id).sort(),r=m.value.map(d=>d.id).sort();if(JSON.stringify(t)!==JSON.stringify(r)){const d=m.value.filter(i=>!o.value.associatedAgents.some(P=>P.id===i.id)),a=o.value.associatedAgents.filter(i=>!m.value.some(P=>P.id===i.id));o.value.associatedAgents=JSON.parse(JSON.stringify(m.value)),d.forEach(i=>{p(`Agent "${i.name}" added`,"success")}),a.forEach(i=>{p(`Agent "${i.name}" removed`,"success")}),h()}}I.value=!1,m.value=[]},H=e=>m.value.some(t=>t.id===e.id),ae=e=>{if(!H(e))m.value.push(e);else{const t=m.value.findIndex(r=>r.id===e.id);t!==-1&&m.value.splice(t,1)}},oe=e=>{const t=o.value.associatedAgents.find(r=>r.id===e);if(t){const r=t.name;o.value.associatedAgents=o.value.associatedAgents.filter(d=>d.id!==e),p(`Agent "${r}" removed`,"success"),h()}},le=()=>o.value.type==="buyer-rep"?o.value.buyerName||"Buyer":o.value.type==="seller-rep"?o.value.sellerName||"Seller":o.value.title||"Client",ne=()=>{U.value.click()},re=e=>{Array.from(e.target.files).forEach(G)},ie=e=>{Array.from(e.dataTransfer.files).forEach(G)},G=async e=>{try{const t={name:e.name,type:e.type,size:e.size,content:null,preview:null};z(e.type)?(t.preview=URL.createObjectURL(e),t.content=await ce(e)):Z(e.type)&&(e.type==="application/pdf"?t.content=await pe(e):t.content=await ue(e)),w.value.push(t),h(),p(`File "${e.name}" added successfully`,"success")}catch(t){p(`Error reading file ${e.name}: ${t.message}`,"error")}},de=e=>{let t="";e<g.value.length?(t=g.value[e].name,g.value.splice(e,1),o.value.files.splice(e,1)):(t=w.value[e-g.value.length].name,w.value.splice(e-g.value.length,1)),h(),p(`File "${t}" removed`,"success")},Z=e=>e.includes("pdf")||e.includes("doc")||e.includes("xls")||e.includes("ppt"),z=e=>e.includes("image/"),ue=e=>new Promise((t,r)=>{const d=new FileReader;d.onload=()=>t(d.result),d.onerror=r,d.readAsText(e)}),ce=e=>new Promise((t,r)=>{const d=new FileReader;d.onload=()=>t(d.result),d.onerror=r,d.readAsDataURL(e)}),pe=async e=>new Promise(t=>{const r=new FileReader;r.onload=()=>t("PDF content preview (requires pdf.js for full text)"),r.readAsArrayBuffer(e)}),E=u([]),me=u(0),p=(e,t="success")=>{const r=me.value++;E.value.push({id:r,message:e,type:t,timestamp:Date.now()}),setTimeout(()=>{Q(r)},5e3)},Q=e=>{const t=E.value.findIndex(r=>r.id===e);t!==-1&&E.value.splice(t,1)},B=f(()=>{const e=D.value,t=[{name:"title",label:"Document Title",type:"text",required:!0},{name:"description",label:"Description",type:"textarea",required:!1}],r={"buyer-rep":[{name:"buyerName",label:"Buyer name",type:"text",required:!0,placeholder:"Enter buyer's full name"},{name:"buyerEmail",label:"Buyer Email",type:"email",required:!0,placeholder:"johndoe@gmail.com"},{name:"phoneNumber",label:"Phone Number",type:"tel",required:!0,placeholder:"555-123-4567"},{name:"propertyType",label:"Property Type",type:"select",required:!0,options:["Single Family Home","Condo","Townhouse","Multi-Family","Land","Commercial"]},{name:"budgetRange",label:"Budget Range",type:"text",required:!0,placeholder:"$200,000-$500,000"},{name:"additionalNotes",label:"Additional Notes/Requirements",type:"textarea",required:!1,placeholder:"Any specific requirements?"}],"seller-rep":[{name:"sellerName",label:"Seller name",type:"text",required:!0,placeholder:"Enter seller's full name"},{name:"sellerEmail",label:"Seller Email",type:"email",required:!0,placeholder:"johndoe@gmail.com"},{name:"phoneNumber",label:"Phone Number",type:"tel",required:!0,placeholder:"555-123-4567"},{name:"propertyType",label:"Property Type",type:"select",required:!0,options:["Single Family Home","Condo","Townhouse","Multi-Family","Land","Commercial"]},{name:"propertyAddress",label:"Property Address",type:"text",required:!0,placeholder:"e.g., 123 Main St, City, State, ZIP"},{name:"listingPrice",label:"Desired Listing Price",type:"text",required:!0,placeholder:"e.g., $500,000"},{name:"additionalNotes",label:"Additional Notes/Requirements",type:"textarea",required:!1,placeholder:"Any specific requirements or details about the property?"}],mls:[{name:"propertyAddress",label:"Property Address",type:"text",required:!0,placeholder:"e.g., 123 Main St, City, State, ZIP"},{name:"listingPrice",label:"Listing Price",type:"text",required:!0,placeholder:"e.g., $500,000"},{name:"bedrooms",label:"Bedrooms",type:"number",required:!0,placeholder:"e.g., 3"},{name:"bathrooms",label:"Bathrooms",type:"number",required:!0,placeholder:"e.g., 2"},{name:"squareFootage",label:"Square Footage",type:"text",required:!0,placeholder:"e.g., 2,000 sq ft"},{name:"propertyDescription",label:"Property Description",type:"textarea",required:!0,placeholder:"Describe the property features and amenities"}]};return[...t,...r[e]||[]]});ke(async()=>{if(y)try{const e=await R.getDocument(y);if(console.log("Fetched document:",e),e)D.value=e.type||"buyer-rep",console.log("Document type set to:",D.value),o.value={id:e.id,type:D.value,title:e.name||"",description:e.description||"",associatedAgents:e.agents||[],files:e.files||[],buyerName:e.buyerName||"",buyerEmail:e.buyerEmail||"",phoneNumber:e.phoneNumber||"",propertyType:e.propertyType||"",budgetRange:e.budgetRange||"",additionalNotes:e.additionalNotes||"",sellerName:e.sellerName||"",sellerEmail:e.sellerEmail||"",propertyAddress:e.propertyAddress||"",listingPrice:e.listingPrice||"",squareFootage:e.squareFootage||"",bedrooms:e.bedrooms||"",bathrooms:e.bathrooms||"",propertyDescription:e.propertyDescription||"",clientId:e.clientId||null,createdAt:e.createdAt||""},setTimeout(()=>{console.log("Mapped document form data:",o.value),console.log("Document fields:",B.value)},0),x.value=JSON.parse(JSON.stringify(o.value)),g.value=e.files?[...e.files]:[];else{p("Document not found","error");const t=V();t.currentRole==="admin"?v.push("/receipts-docs/view-docs"):t.currentRole==="agent"?v.push("/profile/documents"):v.push("/")}}catch(e){console.error("Error loading document:",e),p("Error loading document: "+e.message,"error");const t=V();t.currentRole==="admin"?v.push("/receipts-docs/view-docs"):t.currentRole==="agent"?v.push("/profile/documents"):v.push("/")}else D.value=L.query.type||"buyer-rep",x.value=JSON.parse(JSON.stringify(o.value))});const A=u({}),ve=()=>{const e={};return B.value.forEach(t=>{t.required&&!o.value[t.name]&&(e[t.name]=`${t.label} is required`)}),A.value=e,Object.keys(e).length===0},W=V(),ye=f(()=>"/receipts-docs/view-docs"),ge=f(()=>y?`/receipts-docs/document/${y}`:"/profile/documents"),he=f(()=>`/receipts-docs/document/${y}`),O=f(()=>W.currentRole==="admin"?ye.value:W.currentRole==="agent"?ge.value:he.value),J=()=>{S.value?_.value=!0:v.push(O.value)},fe=()=>{if(!ve()){p("Please fill in all required fields","error");return}S.value?_.value=!0:v.push(O.value)},be=async()=>{try{p("Saving document...","info");const e={id:o.value.id,name:o.value.title,type:o.value.type,description:o.value.description,agents:o.value.associatedAgents,files:[...g.value,...w.value],clientId:o.value.clientId,createdAt:o.value.createdAt||new Date().toISOString().split("T")[0]};o.value.type==="buyer-rep"?(e.buyerName=o.value.buyerName,e.buyerEmail=o.value.buyerEmail,e.phoneNumber=o.value.phoneNumber,e.propertyType=o.value.propertyType,e.budgetRange=o.value.budgetRange,e.additionalNotes=o.value.additionalNotes):o.value.type==="seller-rep"?(e.sellerName=o.value.sellerName,e.sellerEmail=o.value.sellerEmail,e.phoneNumber=o.value.phoneNumber,e.propertyType=o.value.propertyType,e.propertyAddress=o.value.propertyAddress,e.listingPrice=o.value.listingPrice,e.additionalNotes=o.value.additionalNotes):o.value.type==="mls"&&(e.propertyAddress=o.value.propertyAddress,e.listingPrice=o.value.listingPrice,e.bedrooms=o.value.bedrooms,e.bathrooms=o.value.bathrooms,e.squareFootage=o.value.squareFootage,e.propertyDescription=o.value.propertyDescription),y?await R.updateDocument(y,e):await R.addDocument(e),p("Document saved successfully","success"),setTimeout(()=>{v.push(O.value)},1e3)}catch(e){console.error("Error saving document:",e),p("Error saving document: "+e.message,"error")}_.value=!1};return(e,t)=>{var d;const r=Ne("router-link");return n(),l("div",Fe,[s("div",qe,[X(Ce,{name:"notification"},{default:Y(()=>[(n(!0),l(C,null,N(E.value,a=>(n(),l("div",{key:a.id,class:q(["notification",a.type])},[s("span",Ee,c(a.message),1),s("button",{class:"notification-close",onClick:i=>Q(a.id)},"×",8,Pe)],2))),128))]),_:1})]),s("div",Me,[s("div",Te,[s("button",{class:"back-button",onClick:J},t[7]||(t[7]=[s("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},[s("path",{d:"M15.8337 10H4.16699M4.16699 10L10.0003 15.8333M4.16699 10L10.0003 4.16667",stroke:"currentColor","stroke-width":"1.67","stroke-linecap":"round","stroke-linejoin":"round"})],-1),F(" Back ")])),s("h1",Le,"Currently editing: Legal documentation for "+c(le()),1)]),s("div",Re,[X(r,{to:"/receipts-docs/view-docs",class:"breadcrumb-link"},{default:Y(()=>t[8]||(t[8]=[F("Documents")])),_:1}),t[9]||(t[9]=s("span",{class:"breadcrumb-separator"},"/",-1)),t[10]||(t[10]=s("span",{class:"breadcrumb-current"},"Legal documentation",-1))])]),s("div",Ie,[s("div",$e,[s("div",je,[s("div",{class:"upload-area",onDrop:M(ie,["prevent"]),onDragover:t[0]||(t[0]=M(()=>{},["prevent"]))},[t[12]||(t[12]=s("div",{class:"upload-icon"},[s("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[s("path",{d:"M12 12V19M12 12L15 15M12 12L9 15M20 16.7428C21.2215 15.734 22 14.2079 22 12.5C22 9.46243 19.5376 7 16.5 7C16.2815 7 16.0771 7.01349 15.8767 7.03857C14.9827 4.67583 12.6997 3 10 3C6.13401 3 3 6.13401 3 10C3 12.2501 4.07741 14.2509 5.75 15.4805",stroke:"#6B7280","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),s("div",{class:"upload-text"},[t[11]||(t[11]=F(" Upload document by Dragging & dropping files or ")),s("button",{onClick:ne,class:"browse-link"},"Browse")]),t[13]||(t[13]=s("div",{class:"upload-formats"}," Supported formats: PDF, DOC, XLS, PPT, JPG, PNG, GIF, TIFF, HEIC ",-1)),s("input",{type:"file",ref_key:"fileInput",ref:U,onChange:re,multiple:"",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.jpg,.jpeg,.png,.gif,.tiff,.heic",class:"hidden"},null,544)],32),s("div",Be,[t[16]||(t[16]=s("h3",{class:"section-title"},"Attached Files",-1)),k.value.length>0?(n(),l("div",Oe,[(n(!0),l(C,null,N(k.value,(a,i)=>(n(),l("div",{key:i,class:"file-item"},[s("div",Je,[Z(a.type)?(n(),l("svg",Ve,t[14]||(t[14]=[s("path",{d:"M7.5 9.16667H12.5M7.5 12.5H10.8333M6.66667 2.5H13.3333L17.5 6.66667V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V4.16667C2.5 3.72464 2.67559 3.30072 2.98816 2.98816C3.30072 2.67559 3.72464 2.5 4.16667 2.5H6.66667ZM13.3333 2.5V6.66667H17.5L13.3333 2.5Z",stroke:"#6B7280","stroke-width":"1.67","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))):z(a.type)?(n(),l("img",{key:1,src:a.preview,class:"file-preview",alt:a.name},null,8,Ue)):b("",!0),s("div",He,[s("span",Ge,c(a.name),1),s("span",Ze,c(a.type),1)])]),s("button",{onClick:P=>de(i),class:"file-remove"},t[15]||(t[15]=[s("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},[s("path",{d:"M13.3333 5L6.66667 11.6667M6.66667 5L13.3333 11.6667",stroke:"#EF4444","stroke-width":"1.67","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,ze)]))),128))])):(n(),l("div",Qe," No files attached yet "))]),k.value.length>0?(n(),l("div",We,[s("h3",Xe,c(k.value.length)+" "+c(k.value.length===1?"file":"files")+" attached",1)])):b("",!0)]),s("div",Ye,[t[17]||(t[17]=s("div",{class:"section-header"},[s("h2",{class:"section-title"},"Edit file"),s("p",{class:"section-description"},"Here you can edit your saved files and document")],-1)),s("div",Ke,[(n(!0),l(C,null,N(B.value,a=>(n(),l("div",{key:a.name,class:"form-group"},[s("label",{for:a.name,class:"form-label"},[F(c(a.label)+" ",1),a.required?(n(),l("span",tt,"*")):b("",!0)],8,et),a.type==="textarea"?T((n(),l("textarea",{key:0,id:a.name,"onUpdate:modelValue":i=>o.value[a.name]=i,placeholder:a.placeholder,class:q(["form-control",{error:A.value[a.name]}]),rows:"4",onInput:h},null,42,st)),[[K,o.value[a.name]]]):a.type==="select"?T((n(),l("select",{key:1,id:a.name,"onUpdate:modelValue":i=>o.value[a.name]=i,class:q(["form-control",{error:A.value[a.name]}]),onChange:h},[s("option",ot,"Select "+c(a.label.toLowerCase()),1),(n(!0),l(C,null,N(a.options,i=>(n(),l("option",{key:i,value:i},c(i),9,lt))),128))],42,at)),[[we,o.value[a.name]]]):(n(),l("div",nt,[T(s("input",{id:a.name,"onUpdate:modelValue":i=>o.value[a.name]=i,type:a.type,placeholder:a.placeholder,class:q(["form-control",{error:A.value[a.name]}]),onInput:h},null,42,rt),[[Se,o.value[a.name]]])])),A.value[a.name]?(n(),l("span",it,c(A.value[a.name]),1)):b("",!0)]))),128))])])]),s("div",dt,[s("div",ut,[t[20]||(t[20]=s("h3",{class:"agents-title"},"Associated agents",-1)),(d=o.value.associatedAgents)!=null&&d.length?(n(),l("div",ct,[(n(!0),l(C,null,N(o.value.associatedAgents,a=>(n(),l("div",{key:a.id,class:"agent-card"},[s("div",pt,[s("img",{src:a.avatar,alt:a.name,class:"agent-avatar"},null,8,mt),s("div",vt,[s("span",yt,c(a.name),1),s("span",gt,c(a.email),1)])]),s("button",{onClick:i=>oe(a.id),class:"remove-agent"},t[18]||(t[18]=[s("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},[s("path",{d:"M13.3333 5L6.66667 11.6667M6.66667 5L13.3333 11.6667",stroke:"#EF4444","stroke-width":"1.67","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,ht)]))),128))])):b("",!0),s("button",{class:"add-agent-button",onClick:se},t[19]||(t[19]=[s("span",{class:"plus-icon"},"+",-1),F(" Add agent ")]))])])]),s("div",{class:"page-footer"},[s("button",{class:"btn-secondary",onClick:J},"Exit"),s("button",{class:"btn-primary",onClick:fe},"Save")]),_.value?(n(),l("div",{key:0,class:"modal-overlay",onClick:t[2]||(t[2]=M(a=>_.value=!1,["self"]))},[s("div",ft,[s("div",bt,[t[21]||(t[21]=s("h3",null,"Unsaved Changes",-1)),s("button",{onClick:t[1]||(t[1]=a=>_.value=!1),class:"modal-close"},"×")]),t[22]||(t[22]=s("div",{class:"modal-body"},[s("p",null,"You have unsaved changes. What would you like to do?")],-1)),s("div",{class:"modal-footer"},[s("button",{class:"btn-secondary",onClick:J},"Discard Changes"),s("button",{class:"btn-primary",onClick:be},"Save Changes")])])])):b("",!0),I.value?(n(),l("div",{key:1,class:"modal-overlay",onClick:t[6]||(t[6]=M(a=>j(!1),["self"]))},[s("div",_t,[s("div",kt,[t[23]||(t[23]=s("h3",null,"Select Agents",-1)),s("button",{onClick:t[3]||(t[3]=a=>j(!1)),class:"modal-close"},"×")]),s("div",At,[s("div",Ct,[T(s("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=a=>$.value=a),placeholder:"Search agents by name or email",class:"form-control"},null,512),[[K,$.value]])]),s("div",Nt,[(n(!0),l(C,null,N(te.value,a=>(n(),l("div",{key:a.id,class:q(["agent-item",{selected:H(a)}]),onClick:i=>ae(a)},[s("img",{src:a.avatar,alt:a.name,class:"agent-avatar"},null,8,St),s("div",xt,[s("span",Dt,c(a.name),1),s("span",Ft,c(a.experience),1)])],10,wt))),128))])]),s("div",qt,[s("button",{class:"btn-primary",onClick:t[5]||(t[5]=a=>j(!0))},"Done")])])])):b("",!0)])}}},Rt=De(Et,[["__scopeId","data-v-ccb4df6d"]]);export{Rt as default};
