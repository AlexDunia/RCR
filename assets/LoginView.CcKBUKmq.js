import{r as S,R as F,o as N,b as y,e as a,v as A,t as I,s as q,I as x,L as V,n as C,S as M,j as P,W as O,k as R,l as E,h as j,m as K,i as b}from"./vendor.Bh3_gxHF.js";import{o as u,_ as H,u as G,b as X}from"./index.Cv61STol.js";import{s as Y,v as J}from"./validators.B0vmbOYH.js";const h="/api",v="auth_token",k="refresh_token",L="user_data";u.defaults.withCredentials=!0;u.interceptors.request.use(async e=>{var l;const r=(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content");r&&(e.headers["X-CSRF-TOKEN"]=r);const d=localStorage.getItem(v);return d&&(e.headers.Authorization=`Bearer ${d}`),e.headers["X-Requested-With"]="XMLHttpRequest",e.headers.Accept="application/json",e});u.interceptors.response.use(e=>e,async e=>{var r,d;if(((r=e.response)==null?void 0:r.status)===429){const l=e.response.headers["retry-after"];throw{message:`Too many attempts. Please try again in ${e.response.data.minutes_until_available} minutes.`,status:429,retryAfter:parseInt(l)}}if(((d=e.response)==null?void 0:d.status)===401)try{const l=localStorage.getItem(k);if(l){const o=await u.post(`${h}/auth/refresh`,{refresh_token:l}),{token:s,refresh_token:c}=o.data;return localStorage.setItem(v,s),localStorage.setItem(k,c),e.config.headers.Authorization=`Bearer ${s}`,u(e.config)}}catch{_.logout()}return Promise.reject(e)});const _={async initializeAuth(){try{await u.get("/sanctum/csrf-cookie")}catch(e){throw console.error("Failed to initialize auth:",e),e}},async login({email:e,password:r,device_name:d,remember:l=!1}){try{await this.initializeAuth();const o={email:Y(e.toLowerCase()),password:r,device_name:d,remember:l},s=await u.post(`${h}/auth/login`,o);return l&&s.data.token&&(localStorage.setItem(v,s.data.token),s.data.refresh_token&&localStorage.setItem(k,s.data.refresh_token),localStorage.setItem(L,JSON.stringify(s.data.user))),s.data.token&&(u.defaults.headers.common.Authorization=`Bearer ${s.data.token}`),s.data}catch(o){throw this.handleError(o)}},async logout(){try{await u.post(`${h}/auth/logout`),delete u.defaults.headers.common.Authorization,localStorage.removeItem(v),localStorage.removeItem(k),localStorage.removeItem(L)}catch(e){console.error("Logout error:",e)}finally{this.clearAuthData()}},clearAuthData(){localStorage.removeItem(v),localStorage.removeItem(k),localStorage.removeItem(L),delete u.defaults.headers.common.Authorization},isAuthenticated(){return!!localStorage.getItem(v)},getStoredUserData(){const e=localStorage.getItem(L);return e?JSON.parse(e):null},async getCurrentUser(){try{const e=this.getStoredUserData();return e||(await u.get(`${h}/auth/user`)).data}catch(e){throw this.handleError(e)}},async verifyToken(){try{return(await u.get(`${h}/auth/verify`)).data.valid}catch{return!1}},async socialLogin(e){try{return(await u.get(`${h}/auth/${e}/url`)).data}catch(r){throw this.handleError(r)}},async generateFingerprint(){const e=[navigator.userAgent,navigator.language,screen.width,screen.height,new Date().getTimezoneOffset(),navigator.hardwareConcurrency,navigator.platform].join("|"),r=new TextEncoder().encode(e),d=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(d)).map(o=>o.toString(16).padStart(2,"0")).join("")},handleError(e){return e.response?e.response.status===401?(this.logout(),{status:401,message:"Session expired. Please login again."}):{status:e.response.status,message:e.response.data.message||"An error occurred",errors:e.response.data.errors||{}}:{status:500,message:e.message||"Network error occurred",errors:{}}}},W={class:"auth-split-bg"},Q={class:"auth-split-right"},Z={class:"auth-form-container"},ee={key:0,class:"auth-error",role:"alert"},te={class:"form-group"},ae=["disabled"],se={key:0,class:"error-message"},re={class:"form-group"},oe={class:"password-input-wrapper"},ne=["type","disabled"],ie=["aria-label"],le={key:0,class:"error-message"},ue={class:"form-group-checkbox"},de={class:"checkbox-label"},ce=["disabled"],me=["disabled"],ge={key:0,class:"spinner"},pe=["disabled"],he={class:"auth-link-row"},ve={__name:"LoginView",setup(e){const r=K(),d=G(),l=X(),o=S(!1),s=S(null),c=S({}),f=S(!1),i=F({email:"",password:"",remember:!1,device_name:""});N(async()=>{try{i.device_name=await _.generateFingerprint()}catch(n){console.error("Failed to generate device fingerprint:",n),i.device_name=navigator.userAgent}});function z(n){c.value[n]&&delete c.value[n],s.value=null}function U(){f.value=!f.value}function D(){const n={};return i.email.trim()?J(i.email)||(n.email=["Please enter a valid email address"]):n.email=["Email is required"],i.password||(n.password=["Password is required"]),n}async function $(){var n,t,w,m;try{s.value=null,c.value={};const g=D();if(Object.keys(g).length>0){c.value=g;return}o.value=!0,await _.initializeAuth();const p=await _.login({email:i.email.trim().toLowerCase(),password:i.password,device_name:i.device_name,remember:i.remember});d.setToken(p.token),d.setUser(p.user),l.setRole(p.user.role),i.remember&&p.remember_token&&localStorage.setItem("remember_token",p.remember_token);const T=r.currentRoute.value.query.redirect;if(T)await r.replace(T);else switch(p.user.role){case"admin":await r.replace("/admin-dashboard");break;case"agent":await r.replace("/agent-dashboard");break;case"client":await r.replace("/client-dashboard");break;default:await r.replace("/")}}catch(g){console.error("Login error:",g),((n=g.response)==null?void 0:n.status)===429?s.value="Too many login attempts. Please try again later.":((t=g.response)==null?void 0:t.status)===401?s.value="Invalid email or password":(m=(w=g.response)==null?void 0:w.data)!=null&&m.message?s.value=g.response.data.message:s.value="An error occurred during login. Please try again.",o.value=!1}}async function B(){try{o.value=!0;const n=await _.socialLogin("google");window.location.href=n.redirect_url}catch(n){console.error("Google login error:",n),s.value="Failed to initialize Google login. Please try again."}finally{o.value=!1}}return(n,t)=>{const w=j("router-link");return b(),y("div",W,[t[13]||(t[13]=a("div",{class:"auth-split-left"},[a("div",{class:"auth-logo-block"},[a("div",{class:"auth-logo"},"Real City"),a("div",{class:"auth-tagline"},"realty inc brokerage")])],-1)),a("div",Q,[a("div",Z,[t[10]||(t[10]=a("div",{class:"auth-title"},"Login to your account",-1)),s.value?(b(),y("div",ee,I(s.value),1)):A("",!0),a("form",{class:"auth-form",onSubmit:q($,["prevent"])},[a("div",te,[x(a("input",{type:"email","onUpdate:modelValue":t[0]||(t[0]=m=>i.email=m),placeholder:"Enter your email address",class:C({error:c.value.email}),onInput:t[1]||(t[1]=m=>z("email")),required:"",disabled:o.value,"aria-label":"Email"},null,42,ae),[[V,i.email]]),c.value.email?(b(),y("span",se,I(c.value.email[0]),1)):A("",!0)]),a("div",re,[a("div",oe,[x(a("input",{type:f.value?"text":"password","onUpdate:modelValue":t[2]||(t[2]=m=>i.password=m),placeholder:"Enter your password",class:C({error:c.value.password}),onInput:t[3]||(t[3]=m=>z("password")),required:"",disabled:o.value,"aria-label":"Password"},null,42,ne),[[M,i.password]]),a("button",{type:"button",class:"toggle-password",onClick:U,"aria-label":f.value?"Hide password":"Show password"},[a("i",{class:C(f.value?"fas fa-eye-slash":"fas fa-eye")},null,2)],8,ie)]),c.value.password?(b(),y("span",le,I(c.value.password[0]),1)):A("",!0)]),a("div",ue,[a("label",de,[x(a("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=m=>i.remember=m),disabled:o.value},null,8,ce),[[O,i.remember]]),t[5]||(t[5]=a("span",null,"Remember me",-1))]),P(w,{to:"/forgot-password",class:"forgot-password"},{default:R(()=>t[6]||(t[6]=[E(" Forgot Password? ")])),_:1})]),a("button",{type:"submit",disabled:o.value,class:"login-button"},[o.value?(b(),y("span",ge)):A("",!0),E(" "+I(o.value?"Logging in...":"Login"),1)],8,me)],32),t[11]||(t[11]=a("div",{class:"auth-divider"},"or",-1)),a("button",{class:"auth-social-btn",onClick:B,disabled:o.value},t[7]||(t[7]=[a("span",{class:"icon-svg"},[a("svg",{width:"22",height:"22",viewBox:"0 0 48 48"},[a("g",null,[a("path",{fill:"#4285F4",d:"M44.5 20H24v8.5h11.7C34.7 33.9 29.8 37 24 37c-7.2 0-13-5.8-13-13s5.8-13 13-13c3.1 0 5.9 1.1 8.1 2.9l6.4-6.4C34.6 5.1 29.6 3 24 3 12.4 3 3 12.4 3 24s9.4 21 21 21c10.5 0 20-7.7 20-21 0-1.3-.1-2.7-.3-4z"})])])],-1),E(" Login with Google ")]),8,pe),t[12]||(t[12]=a("div",{class:"auth-bottom-text"}," By continuing you indicate that you read and agreed to the Terms of Use ",-1)),a("div",he,[t[9]||(t[9]=a("span",null,"Don't have an account?",-1)),P(w,{class:"auth-link",to:"/signup"},{default:R(()=>t[8]||(t[8]=[E("Sign up!")])),_:1})])])])])}}},be=H(ve,[["__scopeId","data-v-0a8aa73f"]]);export{be as default};
