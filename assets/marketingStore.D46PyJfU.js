import{d as F,r as l,c as S}from"./vendor.Bh3_gxHF.js";import{j as N,b as P,i as J}from"./index.Cv61STol.js";const b=N.create({baseURL:"/api",headers:{"Content-Type":"application/json",Accept:"application/json"}});b.interceptors.request.use(k=>{const p=localStorage.getItem("auth_token");return p&&(k.headers.Authorization=`Bearer ${p}`),k});const M=F("marketing",()=>{const k=l(!1),p=l(null),o=e=>{k.value=e},g=e=>{p.value=e},d=()=>{p.value=null},C=(()=>{const e=l([]),n=l(null),h=S(()=>e.value.filter(a=>a.status==="active")),m=async()=>{o(!0),d();try{const a=localStorage.getItem("marketingPlans");e.value=a?JSON.parse(a):[]}catch(a){g("Failed to load marketing plans"),console.error(a)}finally{o(!1)}};return{marketingPlans:e,currentPlan:n,activePlans:h,fetchPlans:m,savePlan:async a=>{o(!0),d();try{const t=P();if(!J("create-marketing-plans"))throw g("You do not have permission to create marketing plans"),new Error("Permission denied: Cannot create marketing plans");const r=localStorage.getItem("marketingPlans"),c=r?JSON.parse(r):[];return a.creationDate||(a.creationDate=new Date().toISOString()),a.creator=t.getCurrentUser(),c.push(a),localStorage.setItem("marketingPlans",JSON.stringify(c)),e.value=c,a}catch(t){throw g(t.message||"Failed to save marketing plan"),console.error(t),t}finally{o(!1)}},getPlanById:async a=>(e.value.length===0&&await m(),n.value=e.value[a]||null,n.value)}})(),I=(()=>{const e=l([]),n=l(null),h=S(()=>e.value.filter(t=>!t.completed)),m=()=>{try{const t=localStorage.getItem("checklists");if(t){console.log("Found old checklist data. Migrating...");const r=JSON.parse(t);if(r&&r.length>0){const c=localStorage.getItem("marketingChecklists"),u=[...c?JSON.parse(c):[]];r.forEach(f=>{u.some(y=>y.id===f.id)||u.push(f)}),localStorage.setItem("marketingChecklists",JSON.stringify(u)),console.log(`Migration complete. Moved ${r.length} checklists.`),localStorage.removeItem("checklists"),console.log("Old checklist data removed after successful migration.")}}}catch(t){console.error("Error migrating checklist data:",t)}},i=async()=>{o(!0),d();try{m();const t=localStorage.getItem("marketingChecklists");e.value=t?JSON.parse(t):[]}catch(t){g("Failed to load marketing checklists"),console.error(t)}finally{o(!1)}};return{marketingChecklists:e,currentChecklist:n,pendingChecklists:h,fetchChecklists:i,saveChecklist:async t=>{o(!0),d();try{const r=localStorage.getItem("marketingChecklists"),c=r?JSON.parse(r):[];t.id||(t.id=Date.now().toString());const s=P();return t.creator=s.getCurrentUser(),c.push(t),localStorage.setItem("marketingChecklists",JSON.stringify(c)),e.value=c,t}catch(r){throw g("Failed to save marketing checklist"),console.error(r),r}finally{o(!1)}},getChecklistById:async t=>(e.value.length===0&&await i(),n.value=e.value.find(r=>r.id===t)||null,n.value)}})(),w=(()=>{const e=l([]),n=l([{id:"X",name:"X",data:[70,55,30,40,20,80,55],lastUpdated:new Date().toISOString(),totalFollowers:20},{id:"Facebook",name:"Facebook",data:[70,55,30,40,20,80,55],lastUpdated:new Date().toISOString(),totalFollowers:20},{id:"LinkedIn",name:"LinkedIn",data:[70,55,30,40,20,80,55],lastUpdated:new Date().toISOString(),totalFollowers:20}]),h=l(null),m=l({likes:600,comments:1500,shares:3006,impressions:15e3,reach:180,videoViews:"No videos posted",avgWatchTime:"Null"}),i=S(()=>e.value.filter(s=>s.status==="scheduled")),v=S(()=>e.value.filter(s=>s.status==="published")),a=async()=>{o(!0),d();try{const s=localStorage.getItem("socialPosts");e.value=s?JSON.parse(s):[]}catch(s){g("Failed to load social media posts"),console.error(s)}finally{o(!1)}};return{posts:e,platforms:n,currentPost:h,currentStats:m,scheduledPosts:i,publishedPosts:v,fetchPosts:a,savePost:async s=>{o(!0),d();try{const u=localStorage.getItem("socialPosts"),f=u?JSON.parse(u):[];s.id||(s.id=Date.now().toString());const y=P();return s.creator=y.getCurrentUser(),f.push(s),localStorage.setItem("socialPosts",JSON.stringify(f)),e.value=f,s}catch(u){throw g("Failed to save social media post"),console.error(u),u}finally{o(!1)}},fetchPlatformMetrics:async()=>{o(!0),d();try{await new Promise(s=>setTimeout(s,500))}catch(s){g("Failed to load social media metrics"),console.error(s)}finally{o(!1)}},getPostById:async s=>(e.value.length===0&&await a(),h.value=e.value.find(u=>u.id===s)||null,h.value)}})(),O=(()=>{const e=l([]),n=l(["Email","Social Media","Flyers","Postcards"]);return{marketingTemplates:e,templateCategories:n,fetchTemplates:async(m=null)=>{o(!0),d();try{await new Promise(i=>setTimeout(i,500)),e.value=[{id:1,title:"Spring Home Sales",category:"Email",thumbnail:"/templates/email-1.jpg"},{id:2,title:"New Listing Announcement",category:"Social Media",thumbnail:"/templates/social-1.jpg"},{id:3,title:"Open House Invitation",category:"Flyers",thumbnail:"/templates/flyer-1.jpg"},{id:4,title:"Just Sold Announcement",category:"Postcards",thumbnail:"/templates/postcard-1.jpg"}],m&&(e.value=e.value.filter(i=>i.category===m))}catch(i){g("Failed to load marketing templates"),console.error(i)}finally{o(!1)}}}})();return{isLoading:k,error:p,plans:C,checklists:I,social:w,templates:O,clearError:d}});export{M as u};
